<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Final Exam Request – CanSTEM</title>
    <style>
        :root {
            --brand: #001161;
            --primary: #4169e1;
            --border: #e5e7eb;
            --soft: #f8fafc;
            --ink: #0f172a;
            --radius: 16px;
            --gap: 16px;
            --pad: 22px
        }

        * {
            box-sizing: border-box
        }

        body {
            font-family: Inter, system-ui, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0;
            color: var(--ink)
        }

        .wrap {
            max-width: 980px;
            margin: 0 auto;
            padding: clamp(16px, 3vw, 28px)
        }

        .header {
            background: #fff;
            border: 1px solid rgba(2, 6, 23, .08);
            border-radius: var(--radius);
            box-shadow: 0 10px 28px rgba(2, 6, 23, .08);
            padding: var(--pad);
            margin-bottom: var(--gap)
        }

        .head-row {
            display: grid;
            grid-template-columns: auto 1fr;
            align-items: center;
            column-gap: 14px
        }

        .logo {
            height: 72px;
            object-fit: contain
        }

        h1 {
            margin: 0;
            color: var(--brand);
            font-size: 24px
        }

        .notice {
            margin: 12px 0 18px;
            padding: 12px 14px;
            line-height: 26px;
            border: 1px dashed var(--border);
            border-radius: 12px;
            background: var(--soft)
        }

        .card {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: var(--pad);
            background: #fff;
            box-shadow: 0 10px 28px rgba(2, 6, 23, .08)
        }

        .section-title {
            display: inline-block;
            background: #eef2ff;
            color: #1e1b4b;
            border: 1px solid #e0e7ff;
            border-radius: 999px;
            padding: 5px 12px;
            font-weight: 700;
            font-size: 13px;
            margin-bottom: 10px
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--gap)
        }

        @media(max-width:820px) {
            .row {
                grid-template-columns: 1fr
            }
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 6px
        }

        .field label {
            font-size: 13px;
            font-weight: 700;
            color: #0b1324
        }

        .req::after {
            content: " *";
            color: #e11d48
        }

        input,
        select,
        textarea {
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 12px 14px;
            font-size: 14px;
            outline: none;
            background: #fff
        }

        input[type="file"] {
            padding: 10px
        }

        .sep {
            border: none;
            border-top: 1px dashed #e2e8f0;
            margin: 16px 0
        }

        .btn {
            background: var(--brand);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 12px 48px;
            font-weight: 800;
            cursor: pointer;
            font-size: 14px
        }

        .status {
            min-height: 1.4em;
            font-size: 14px
        }

        .ok {
            color: #16a34a;
            font-weight: 700
        }

        .err {
            color: #b91c1c;
            font-weight: 700
        }

        .help {
            font-size: 12px;
            color: #64748b
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header class="header">
            <div class="head-row">
                <img class="logo"
                    src="https://canstemeducation.com/wp-content/uploads/2023/07/CanSTEM-Education-Private-School.png"
                    alt="CanSTEM logo">
                <h1>Final Exam Request</h1>
            </div>
        </header>

        <div class="notice">
            Fill out the form below and click <b>Submit</b>. Your request will be emailed to
            <b>canstem.frontdesk@canstemeducation.com</b>. For policies, see:
            <a href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank" rel="noopener">
                https://canstemeducation.com/course-mode-change-terms-policy/
            </a>
            <br><br>
            If the link doesn’t open or you see a “Not found / Drive” message, copy the form URL and open it in
            <b>Chrome Incognito</b> or <b>Safari Private Window</b>.
        </div>

        <section class="card">
            <span class="section-title">Student Details</span>
            <div class="row">
                <div class="field"><label class="req" for="name">Full Name</label><input id="name" required
                        placeholder="First Last"></div>
                <div class="field"><label class="req" for="email">Email</label><input id="email" type="email" required
                        placeholder="name@example.com"></div>
                <div class="field"><label class="req" for="phone">Phone Number</label><input id="phone" required
                        placeholder="+1 555 555 5555"></div>

                <div class="field"><label class="req" for="date">Preferred Exam Date</label><input id="date" type="date"
                        required></div>
            </div>

            <hr class="sep">

            <!-- NEW FIELDS (added before checkboxes) -->
            <div class="row">
                <div class="field">
                    <label class="req" for="grade">Select Grade</label>
                    <select id="grade" required>
                        <option value="">Select grade…</option>
                        <option>Grade 9</option>
                        <option>Grade 10</option>
                        <option>Grade 11</option>
                        <option>Grade 12</option>
                        <option>ESL/ELD Courses</option>
                    </select>
                </div>
                <div class="field"><label class="req" for="course">Course Code or Name</label><input id="course"
                        required placeholder="e.g., MHF4U – Advanced Functions"></div>

                <div class="field">
                    <label class="req" for="mode">Select Mode</label>
                    <select id="mode" required>
                        <option value="">Select mode…</option>
                        <option>Online</option>
                        <option>In-Person</option>
                    </select>
                </div>

                <div class="field">
                    <label class="req" for="stusig">Student Signature</label>
                    <input id="stusig" required placeholder="Type full name as signature">
                </div>
            </div>

            <hr class="sep">

            <div class="row">
                <div class="field">
                    <label><input id="coursework" type="checkbox" required> I completed all coursework.</label>
                    <label><input id="payments" type="checkbox" required> All payments are complete.</label>
                </div>
            </div>
            <div class="field">
                <label><input id="terms" type="checkbox" required> I have read and agree to the
                    <a href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank"
                        rel="noopener">terms and policies</a>.
                </label>
            </div>

            <hr class="sep">

            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
                <button class="btn" id="submitBtn">Submit</button>
                <span class="status" id="status"></span>
            </div>
        </section>
    </div>

    <script>
        /* ====== CONFIG ====== */
        const WEB_APP_URL = 'https://canstemeducation.com/wp-admin/admin-ajax.php?action=canstem_form_email'; // <-- replace after deployment

        /* Helpers */
        const val = id => (document.getElementById(id)?.value || '').trim();

        function isValid() {
            // required fields
            const req = [
                'name', 'email', 'phone',
                'grade', 'course', 'date',
                'mode', 'stusig',
                'terms', 'coursework', 'payments'
            ];
            for (const k of req) {
                const el = document.getElementById(k);
                if (!el) continue;
                if (el.type === 'checkbox') {
                    if (!el.checked) { el.focus(); return false; }
                } else if (!el.value) {
                    el.focus(); return false;
                }
            }
            return true;
        }

        async function submit() {
            if (!isValid()) { setStatus('Please fill all required fields.', false); return; }
            setStatus('Submitting…', null);
            try {
                const payload = {
                    name: val('name'),
                    email: val('email'),
                    phone: val('phone'),
                    grade: val('grade'),
                    courseCode: val('course'),
                    preferredDate: val('date'),
                    mode: val('mode'),
                    studentSig: val('stusig'),
                    courseworkDone: document.getElementById('coursework').checked,
                    paymentsDone: document.getElementById('payments').checked,
                    acceptTerms: document.getElementById('terms').checked
                };

                const resp = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await resp.json().catch(() => ({ ok: false, error: 'Invalid server response' }));

                if (resp.ok && data.ok) {
                    // clear
                    document.querySelectorAll('input,textarea,select').forEach(x => {
                        if (x.type === 'checkbox') x.checked = false;
                        else if (x.type === 'file') x.value = '';
                        else x.value = '';
                    });
                    setStatus('Success! Your request has been emailed to the front desk.', true);
                } else {
                    setStatus(data.error || 'Error sending your request. Please try again.', false);
                }
            } catch (e) {
                setStatus('Network error. Please try again.', false);
            }
        }

        function setStatus(msg, ok) {
            const el = document.getElementById('status');
            el.classList.remove('ok', 'err');
            el.textContent = msg;
            if (ok === true) el.classList.add('ok');
            else if (ok === false) el.classList.add('err');
        }

        document.getElementById('submitBtn').addEventListener('click', e => { e.preventDefault(); submit(); });
    </script>
</body>

</html>